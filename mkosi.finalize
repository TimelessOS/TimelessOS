#!/bin/bash

# Copy files to /usr/share/factory/etc
cp --archive --no-target-directory "$BUILDROOT/etc" "$BUILDROOT/usr/share/factory/etc"

# SDDM Should be the default display-manager
ln -s "$BUILDROOT/usr/lib/systemd/system/sddm.service" "$BUILDROOT/usr/lib/systemd/system/display-manager.service"

# Remove garbage desktop entries
rm "$BUILDROOT/usr/share/applications/vim.desktop"
rm "$BUILDROOT/usr/share/applications/hplip.desktop"
rm "$BUILDROOT/usr/share/applications/hp-uiscan.desktop"
rm "$BUILDROOT/usr/share/applications/qv4l2.desktop"
rm "$BUILDROOT/usr/share/applications/avahi-discover.desktop"
rm "$BUILDROOT/usr/share/applications/htop.desktop"

# Install Flint
git clone https://github.com/TimelessOS/Flint
pushd flint

cargo build --release --all-features
cp ./target/release/flint "$BUILDROOT/usr/bin/flint"

FLINT_ROOT="$BUILDROOT/usr/share/factory/var/lib/flint/"
mkdir -pv "$FLINT_ROOT"

# Uncomment the following with whatever repo of your choice.
# ./target/release/flint --root=$FLINT_ROOT repo add REPO_NAME REPO_URL

popd